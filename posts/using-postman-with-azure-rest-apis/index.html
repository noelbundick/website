<!doctype html><html lang=en-us><head><title>Using Postman with Azure REST APIs | Noel Bundick</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Azure has a plethora of APIs to interact with, and a lot of them have friendly wrappers via the Azure Portal, CLI or PowerShell cmdlets. But sometimes, I want to interact with services on a more detailed level, or try out newer API versions than the current tooling allows for.
Postman is an awesome tool for interacting directly with APIs. Unfortunately, dealing with authorization isn&rsquo;t always straightforward. I&rsquo;ve compiled some of my recent hacking around with the hope that it will save you some pain and help you get you started."><meta name=generator content="Hugo 0.99.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.css><link rel=stylesheet href=/fontawesome/css/brands.min.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a></nav><main class=main><section id=single><h1 class=title>Using Postman with Azure REST APIs</h1><div class=tip><time datetime="2017-05-23 10:09:44 +0000 UTC">May 23, 2017</time>
<span class=split>¬∑</span>
<span>657 words</span>
<span class=split>¬∑</span>
<span>4 minute read</span></div><aside class=toc><details><summary>Table of Contents</summary><div><nav id=TableOfContents><ul><li><a href=#create-service-principal-via-script>Create Service Principal via script</a></li><li><a href=#add-required-permissions-in-the-portal>Add Required Permissions in the Portal</a></li></ul></nav></div></details></aside><div class=content><p>Azure has <a href=https://docs.microsoft.com/en-us/rest/api/ target=_blank rel=noopener>a plethora of APIs</a> to interact with, and a lot of them have friendly wrappers via the Azure Portal, CLI or PowerShell cmdlets. But sometimes, I want to interact with services on a more detailed level, or try out newer API versions than the current tooling allows for.</p><p><a href=https://www.getpostman.com target=_blank rel=noopener>Postman</a> is an awesome tool for interacting directly with APIs. Unfortunately, dealing with authorization isn&rsquo;t always straightforward. I&rsquo;ve compiled some of my recent hacking around with the hope that it will save you some pain and help you get you started.</p><p>Note: Most Azure REST APIs use OAuth2, which is what I&rsquo;ll focus on here. For other APIs (specifically Azure Storage), check the links at the end of of the post.</p><h1 id=prerequisites>Prerequisites <a href=#prerequisites class=anchor>üîó</a></h1><p>I use Bash (on Windows) for everything these days. To follow along, you&rsquo;ll want the following:</p><ul><li>Bash on Windows</li><li><a href=https://docs.microsoft.com/en-us/cli/azure/install-azure-cli#windows target=_blank rel=noopener>Azure CLI</a></li><li><a href=https://stedolan.github.io/jq/ target=_blank rel=noopener>jq</a> - This is a super handy command-line JSON processor ( <code>sudo apt-get install jq</code> )</li></ul><h1 id=configure-azure-active-directory>Configure Azure Active Directory <a href=#configure-azure-active-directory class=anchor>üîó</a></h1><p>First, we&rsquo;ll need to set up an application and grant some permissions in AAD. I&rsquo;ve created a script to help you out, because the configuration wasn&rsquo;t immediately obvious (hence this post).</p><h2 id=create-service-principal-via-script>Create Service Principal via script <a href=#create-service-principal-via-script class=anchor>üîó</a></h2><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#586e75># Download script &amp; mark as executable</span>
</span></span><span style=display:flex><span>curl -O https://gist.githubusercontent.com/noelbundick/1e1854b14c0a134de778345a6884a168/raw/c143e08128857632a9d566eadf2430adc04ff38c/createServicePrincipal.sh
</span></span><span style=display:flex><span>chmod +x createServicePrincipal.sh
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#586e75># Usage</span>
</span></span><span style=display:flex><span>./createServicePrincipal.sh NAME
</span></span></code></pre></div><h2 id=add-required-permissions-in-the-portal>Add Required Permissions in the Portal <a href=#add-required-permissions-in-the-portal class=anchor>üîó</a></h2><p>The app (Postman) needs some permissions to be able to access Azure on your behalf. I&rsquo;m not sure how to update the application manifest automatically just yet, so I&rsquo;m going to point you to the Portal. If you know how to do this in a script, please leave me a comment or ping me on <a href=https://twitter.com/acanthamoeba target=_blank rel=noopener>Twitter</a>. To save on navigation, the script will output the specific URL you need. Follow these steps:</p><p>1. Go to Required Permissions</p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/aad-application.png alt="Go to Required Permissions"></p></p><p>2. Add a Required Permission</p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/aad-required-permissions.png alt="Click the Add button"></p></p><p>3. Select &lsquo;Windows Azure Service Management API&rsquo;</p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/aad-api-azure-service-management.png alt="Select Windows Azure Service Management API"></p></p><p>4. Select &lsquo;Access Azure Service Management as organization users (preview)&rsquo;</p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/aad-delegated-permissions.png alt="Enable delegated permissions"></p></p><p>5. Done!</p><h1 id=configuring-postman>Configuring Postman <a href=#configuring-postman class=anchor>üîó</a></h1><p>We&rsquo;ll be using Postman&rsquo;s native OAuth2 functionality here to get an OAuth token & attach it to our requests. The output from the previous script has all the info you need to configure Postman.</p><p>1. Visit the Authorization tab and select <code>OAuth 2.0</code></p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/postman-authorization.png alt="Postman Authorization tab"></p></p><p>2. Hit <code>Get New Access Token</code></p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/postman-get-access-token.png alt="Select OAuth2"></p></p><p>3. Enter the values from the script output and make sure you&rsquo;re using the <code>Authorization Code</code> grant type</p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/postman-oauth2-config.png alt="Use the output values from the script"></p></p><p>4. <code>Request Token</code>! You&rsquo;ll be prompted to login with your credentials. On your first time, you&rsquo;ll also need to authorize your app</p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/postman-initial-grant.png alt="You'll see something like this when you get your first token"></p></p><p>5. You&rsquo;ll see a new token in your list of Existing Tokens. Select it & hit <code>Use Token</code>. This will set the Authorization header of your current request to use the Bearer token you just got from AAD</p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/postman-tokens.png alt="Look at that shiny token!"></p></p><p>6. All done! You&rsquo;ve got a proper Authorization header, and can now make requests against Azure Resource Manager. When your token expires, repeat steps 4 and 5 to get a new token.</p><p><p class=markdown-image><img src=/posts/using-postman-with-azure-rest-apis/postman-bearer-token.png alt="A fully armed and operational Authorization token"></p></p><h1 id=next-steps>Next steps <a href=#next-steps class=anchor>üîó</a></h1><p>You should be able to modify this flow to work for lots of other services that use Azure AD. If you do, make sure you pay attention to a few things in particular:</p><ul><li>The Required Permissions for the application<ul><li>Ex - If you&rsquo;re hitting Power BI, you&rsquo;ll want to add it to the app in AAD</li></ul></li><li>The Auth URL and Access Token URLs<ul><li>Pay special attention to the <code>resource</code> parameter in the query string and make sure it lines up with your target service</li></ul></li></ul><h1 id=references>References <a href=#references class=anchor>üîó</a></h1><p>There are a ton of cool things you can do with Postman - this only scratches the surface. These links were helpful for me, and are a great place to learn more. Thanks for reading!</p><ul><li><a href=http://blog.jongallant.com/2017/03/azure-active-directory-access-tokens-postman/ target=_blank rel=noopener>How to Use Azure Active Directory (AAD) Access Tokens in Postman</a> - Use Postman environment variables with AAD tokens</li><li><a href=http://blog.tyang.org/2017/04/26/using-postman-invoking-azure-resource-management-apis/ target=_blank rel=noopener>Using Postman Invoking Azure Resource Management APIs</a> - A PowerShell-centric approach</li><li><a href=http://blog.jongallant.com/2017/03/azure-storage-sas-tokens-postman/ target=_blank rel=noopener>Generate Azure Storage SAS Tokens via Postman</a> - Use the Pre-request Script sandbox to easily use the Azure Storage REST API</li></ul></div><div class=tags><a href=/tags/azure>azure</a></div></section></main><section><ul class=post-list><li>2021-10-14
<a href=/gists/optimizing-rust-container-builds/>Optimizing Rust container builds<h2></h2></a></li><li>2021-09-19
<a href=/gists/wsl2-container-development-with-moby/>WSL2 container development with Moby<h2></h2></a></li><li>2019-12-17
<a href=/gists/rdp-from-wsl/>RDP from WSL<h2></h2></a></li><li>2019-06-28
<a href=/gists/how-to-use-docker-build-secrets/>How to use Docker build secrets<h2></h2></a></li><li>2019-06-12
<a href=/gists/consuming-packages-from-a-private-azure-pipelines-python-artifact-feed/>Consuming packages from a private Azure Pipelines Python artifact feed<h2></h2></a></li><li>2019-01-13
<a href=/gists/gists-as-a-content-management-system/>Gists as a content management system<h2></h2></a></li><li>2019-01-12
<a href=/gists/azure-function-w--user-assigned-identity/>Azure Function w/ User Assigned Identity<h2></h2></a></li><li>2018-12-15
<a href=/gists/secure-code-execution-via-arm-template-and-azure-container-instances/>Secure code execution via ARM template and Azure Container Instances<h2></h2></a></li><li>2018-12-10
<a href=/gists/azure-redis-cli/>azure-redis-cli<h2></h2></a></li><li>2018-12-10
<a href=/gists/resize-azure-cloud-shell-storage/>Resize Azure Cloud Shell storage<h2></h2></a></li></ul></section><footer id=footer><div id=social><a class=symbol href=https://www.github.com/noelbundick><i class="fa-brands fa-github"></i></a>
<a class=symbol href=https://www.linkedin.com/in/noelbundick/><i class="fa-brands fa-linkedin"></i></a>
<a class=symbol href=https://twitter.com/acanthamoeba><i class="fa-brands fa-twitter"></i></a></div><div class=copyright>¬© Copyright
2022
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span>Noel Bundick</div></footer></body></html>