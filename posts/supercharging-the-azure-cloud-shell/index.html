<!doctype html><html lang=en-us><head><title>Supercharging the Azure Cloud Shell | Noel Bundick</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Azure Cloud Shell, recently announced at Build, is an awesome new way to manage your Azure resources. In a nutshell, it&rsquo;s a hosted terminal session you can access from anywhere using your browser. And it&rsquo;s already got most of the basic tools you&rsquo;ll typically need for interacting with your Azure websites, VMs, Kubernetes clusters, and so on.
As I&rsquo;ve been using it more often, I&rsquo;ve found myself wanting a few files I already had locally - ssh keys, helper scripts, and the like."><meta name=generator content="Hugo 0.96.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a></nav><main class=main><section id=single><h1 class=title>Supercharging the Azure Cloud Shell</h1><div class=tip><time datetime="2017-05-13 14:36:02 +0000 UTC">May 13, 2017</time>
<span class=split>¬∑</span>
<span>898 words</span>
<span class=split>¬∑</span>
<span>5 minute read</span></div><aside class=toc><details><summary>Table of Contents</summary><div><nav id=TableOfContents><ul><li><a href=#warning>Warning!</a></li><li><a href=#update-no-really>(Update) No, really!</a></li><li><a href=#mounting-the-share>Mounting the share</a></li></ul><ul><li><a href=#resources>Resources</a></li></ul></nav></div></details></aside><div class=content><p><a href=https://docs.microsoft.com/en-us/azure/cloud-shell/overview target=_blank rel=noopener>Azure Cloud Shell</a>, recently announced at Build, is an awesome new way to manage your Azure resources. In a nutshell, it&rsquo;s a hosted terminal session you can access from anywhere using your browser. And it&rsquo;s already got most of the basic tools you&rsquo;ll typically need for interacting with your Azure websites, VMs, Kubernetes clusters, and so on.</p><p>As I&rsquo;ve been using it more often, I&rsquo;ve found myself wanting a few files I already had locally - ssh keys, helper scripts, and the like. Cloud Shell uses a normal storage account to keep track of your $HOME directory, and there&rsquo;s already some <a href=https://docs.microsoft.com/en-us/azure/cloud-shell/persisting-shell-storage target=_blank rel=noopener>good docs</a> on how to transfer files to & from a mapped <code>clouddrive</code> share via the Azure Portal.</p><p>But all that clicking gets kind of tedious. I want to treat my <code>clouddrive</code> as if it were a normal folder in Windows, and I want to be able to copy files to & from it using Bash on Windows. Let&rsquo;s see what we can piece together!</p><h1 id=mapping-the-share-to-windows>Mapping the Share to Windows <a href=#mapping-the-share-to-windows class=anchor>üîó</a></h1><p>You&rsquo;ll need a few bits of info on the storage account associated with your Cloud Shell:</p><ul><li>Storage account name (<a href=https://docs.microsoft.com/en-us/azure/cloud-shell/persisting-shell-storage target=_blank rel=noopener>where to find</a>)</li><li>Storage account key (<a href=https://docs.microsoft.com/en-us/azure/storage/storage-create-storage-account#manage-your-storage-access-keys target=_blank rel=noopener>where to find</a>)</li><li>File share name (<a href=https://docs.microsoft.com/en-us/azure/cloud-shell/persisting-shell-storage target=_blank rel=noopener>where to find</a>)</li><li>Target folder - I chose <code>C:\users\Noel\clouddrive</code> to use the same folder name</li></ul><p>Fire up a command prompt, replace the tokens with your values, and execute the following:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#586e75># Save your connection information so you don&#39;t have to enter every time</span>
</span></span><span style=display:flex><span>cmdkey /add:&lt;<span style=color:#b58900>storage-account</span>-name&gt;.file.core.windows.net /user:AZURE\&lt;<span style=color:#b58900>storage-account</span>-name&gt; /pass:&lt;<span style=color:#b58900>storage-account</span>-key&gt;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#586e75># Connect to the file share</span>
</span></span><span style=display:flex><span>net use \\&lt;<span style=color:#b58900>storage-account</span>-name&gt;.file.core.windows.net\&lt;<span style=color:#b58900>share-name</span>&gt;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#586e75># Map the file share on Azure to a local folder</span>
</span></span><span style=display:flex><span>mklink /d &lt;<span style=color:#b58900>target-folder</span>&gt; \\&lt;<span style=color:#b58900>storage-account</span>-name&gt;.file.core.windows.net\&lt;<span style=color:#b58900>share-name</span>&gt;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#586e75># Open up the folder, take a look around!</span>
</span></span><span style=display:flex><span>explorer &lt;<span style=color:#b58900>target-folder</span>&gt;
</span></span><span style=display:flex><span><span style=color:#b58900>cd </span>&lt;<span style=color:#b58900>target-folder</span>&gt;
</span></span><span style=display:flex><span><span style=color:#b58900>dir
</span></span></span></code></pre></div><p>Cool! It&rsquo;s just a normal file share. I can drag & drop, and use any of my normal commands to drop files to & from the share, which I can then access from Cloud Shell.</p><h1 id=mapping-the-share-to-bash-on-windows>Mapping the share to Bash on Windows <a href=#mapping-the-share-to-bash-on-windows class=anchor>üîó</a></h1><p>So that&rsquo;s great and all - but I use Bash on Windows far more often than PowerShell or the Ye Olde Command Prompte. Surely I can just access my files, since they&rsquo;re available in a Windows folder now, right?</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#b58900>cd</span> /mnt/c/Users/Noel
</span></span><span style=display:flex><span>ls -al
</span></span></code></pre></div><p><p class=markdown-image><img src=/posts/supercharging-the-azure-cloud-shell/bash-noclouddrive.png alt="Where is clouddrive?"></p></p><p>Failsauce! Where&rsquo;s my <code>clouddrive</code> folder? Turns out the version of WSL in Creators Update <a href=https://github.com/Microsoft/BashOnWindows/issues/1975 target=_blank rel=noopener>doesn&rsquo;t yet have</a> the latest file system improvements. I&rsquo;ll need at least <a href=https://msdn.microsoft.com/en-us/commandline/wsl/release_notes target=_blank rel=noopener>Build 16176</a> to try this out.</p><h2 id=warning>Warning! <a href=#warning class=anchor>üîó</a></h2><p>If you&rsquo;re following along with me - this is where things might break. I want the latest bits, so I&rsquo;m going to opt in to Fast Ring of the <a href=https://insider.windows.com/ target=_blank rel=noopener>Windows Insider</a> program. Make sure you make an informed decision before deciding to do this. If you&rsquo;re not comfortable with possible carnage on your box, you might want to wait a while after this post and let these WSL updates land in the stable update cycle.</p><h2 id=update-no-really>(Update) No, really! <a href=#update-no-really class=anchor>üîó</a></h2><p>Shortly after publishing this post, I continued about my business, then noticed vim had stopped working. The <strong>good</strong> news is the WSL team <a href=https://github.com/Microsoft/BashOnWindows/issues/2092 target=_blank rel=noopener>already has a fix</a> for it. The <strong>bad</strong> news is that WSL ships as a part of Windows 10, and there&rsquo;s no way to get an exact timeline on when the fix will land.</p><p>Like I said before - don&rsquo;t just opt in to Fast Ring to get shiny new bits without understanding the risks.</p><h2 id=mounting-the-share>Mounting the share <a href=#mounting-the-share class=anchor>üîó</a></h2><p>Okay! Some update magic & a couple of reboots later, I&rsquo;m on Windows 10 Enterprise Preview Build 16193. Let&rsquo;s give it another try</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#b58900>cd</span> /mnt/c/Users/Noel
</span></span><span style=display:flex><span>ls -al
</span></span></code></pre></div><p><p class=markdown-image><img src=/posts/supercharging-the-azure-cloud-shell/bash-seeclouddrive.png alt="Well, hello cloudshell!"></p></p><p>Nice! Looks like Fast Ring is already an improvement. And when I go to look at my files in <code>clouddrive</code></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#b58900>cd</span> clouddrive
</span></span></code></pre></div><p><p class=markdown-image><img src=/posts/supercharging-the-azure-cloud-shell/bash-inputoutputerror.png alt="Nothing's ever that easy"></p></p><p>Well, that didn&rsquo;t quite work out. Not sure what&rsquo;s going on here. I&rsquo;ll send some feedback to the WSL team on this. I&rsquo;m in uncharted territory. But maybe I can get it working anyway. In the <a href=https://blogs.msdn.microsoft.com/wsl/2017/04/18/file-system-improvements-to-the-windows-subsystem-for-linux/ target=_blank rel=noopener>blog post</a> announcing the latest filesystem improvements, it looks like I can mount a network location directly via the <code>mount</code> command.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#b58900>cd</span> ~
</span></span><span style=display:flex><span>mkdir clouddrive
</span></span><span style=display:flex><span>sudo mount -t drvfs <span style=color:#2aa198>&#39;\\&lt;storage-account-name&gt;.file.core.windows.net\&lt;share-name&gt;&#39;</span> clouddrive
</span></span></code></pre></div><p>Sweet! No errors. Let&rsquo;s poke around and make sure this thing actually works!</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#b58900>cd</span> clouddrive
</span></span><span style=display:flex><span>ls -al
</span></span><span style=display:flex><span><span style=color:#b58900>echo</span> <span style=color:#2aa198>&#34;I wonder if this works...&#34;</span> &gt; test.txt
</span></span></code></pre></div><p><p class=markdown-image><img src=/posts/supercharging-the-azure-cloud-shell/bash-test.png alt="So far, so good"></p></p><p>And now the real moment of truth - none of this time spent was worth anything if I can&rsquo;t read it from my Cloud Shell! Let&rsquo;s check it out in the Azure Portal:</p><p><p class=markdown-image><img src=/posts/supercharging-the-azure-cloud-shell/cloudshell-success.png alt="Houston, we have liftoff!"></p></p><p>Awesome! Well if that works, then I should also be able to access via my Windows tools too, right?</p><p><p class=markdown-image><img src=/posts/supercharging-the-azure-cloud-shell/explorer-success.png alt=Woohoo!></p></p><p>¬†</p><p><p class=markdown-image><img src=/posts/supercharging-the-azure-cloud-shell/windows-success.png alt="This works too!"></p></p><p>Looking great! I wonder if&mldr;</p><p><p class=markdown-image><img src=/posts/supercharging-the-azure-cloud-shell/mobile-success.png alt="So far, so good"></p></p><p>It sure does! Cloud Shell on the Azure mobile app works too. You probably saw this in the Build day 1 keynote, but it hasn&rsquo;t made its way out to everyone just quite yet. I&rsquo;m on the beta iOS Azure app, so I would expect for this to roll out quite soon.</p><h1 id=summary>Summary <a href=#summary class=anchor>üîó</a></h1><p>Not bad for a morning of goofing around. Because Azure Cloud Shell is built on top of other reusable components, nameably Azure Files, I can now quickly & easily move files between my local box, whether that&rsquo;s PowerShell, Bash on Windows, or the Command Prompt. I&rsquo;m sure others will do great things with this - hopefully this will get you up and started</p><h2 id=resources>Resources <a href=#resources class=anchor>üîó</a></h2><ul><li><a href=https://docs.microsoft.com/en-us/azure/cloud-shell/quickstart target=_blank rel=noopener>Azure Cloud Shell Quickstart</a></li><li><a href=https://docs.microsoft.com/en-us/azure/cloud-shell/persisting-shell-storage target=_blank rel=noopener>Persisting Files in Azure Cloud Shell</a></li><li><a href=https://docs.microsoft.com/en-us/azure/storage/storage-dotnet-how-to-use-files#mount-the-file-share target=_blank rel=noopener>Get Started with Azure File storage on Windows</a></li></ul></div><div class=tags><a href=/tags/azure>azure</a>
<a href=/tags/wsl>wsl</a>
<a href=/tags/azure-cloud-shell>azure cloud shell</a></div></section></main><section><ul class=post-list><li>2021-10-14
<a href=/gists/optimizing-rust-container-builds/>Optimizing Rust container builds<h2></h2></a></li><li>2021-09-19
<a href=/gists/wsl2-container-development-with-moby/>WSL2 container development with Moby<h2></h2></a></li><li>2019-12-17
<a href=/gists/rdp-from-wsl/>RDP from WSL<h2></h2></a></li><li>2019-06-28
<a href=/gists/how-to-use-docker-build-secrets/>How to use Docker build secrets<h2></h2></a></li><li>2019-06-12
<a href=/gists/consuming-packages-from-a-private-azure-pipelines-python-artifact-feed/>Consuming packages from a private Azure Pipelines Python artifact feed<h2></h2></a></li><li>2019-01-13
<a href=/gists/gists-as-a-content-management-system/>Gists as a content management system<h2></h2></a></li><li>2019-01-12
<a href=/gists/azure-function-w--user-assigned-identity/>Azure Function w/ User Assigned Identity<h2></h2></a></li><li>2018-12-15
<a href=/gists/secure-code-execution-via-arm-template-and-azure-container-instances/>Secure code execution via ARM template and Azure Container Instances<h2></h2></a></li><li>2018-12-10
<a href=/gists/azure-redis-cli/>azure-redis-cli<h2></h2></a></li><li>2018-12-10
<a href=/gists/resize-azure-cloud-shell-storage/>Resize Azure Cloud Shell storage<h2></h2></a></li></ul></section><footer id=footer><div id=social><a class=symbol href=https://www.github.com/noelbundick rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a><a class=symbol href=https://twitter.com/acanthamoeba rel=me target=_blank><svg fill="#bbb" width="28" height="28" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="438.536" height="438.536" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536"><g><path d="M414.41 24.123C398.333 8.042 378.963.0 356.315.0H82.228C59.58.0 40.21 8.042 24.126 24.123 8.045 40.207.003 59.576.003 82.225v274.084c0 22.647 8.042 42.018 24.123 58.102 16.084 16.084 35.454 24.126 58.102 24.126h274.084c22.648.0 42.018-8.042 58.095-24.126 16.084-16.084 24.126-35.454 24.126-58.102V82.225C438.532 59.576 430.49 40.204 414.41 24.123zM335.471 168.735c.191 1.713.288 4.278.288 7.71.0 15.989-2.334 32.025-6.995 48.104-4.661 16.087-11.8 31.504-21.416 46.254-9.606 14.749-21.074 27.791-34.396 39.115-13.325 11.32-29.311 20.365-47.968 27.117-18.648 6.762-38.637 10.143-59.953 10.143-33.116.0-63.76-8.952-91.931-26.836 4.568.568 9.329.855 14.275.855 27.6.0 52.439-8.565 74.519-25.7-12.941-.185-24.506-4.179-34.688-11.991-10.185-7.803-17.273-17.699-21.271-29.691 4.947.76 8.658 1.137 11.132 1.137 4.187.0 9.042-.76 14.56-2.279-13.894-2.669-25.598-9.562-35.115-20.697-9.519-11.136-14.277-23.84-14.277-38.114v-.571c10.085 4.755 19.602 7.229 28.549 7.422-17.321-11.613-25.981-28.265-25.981-49.963.0-10.66 2.758-20.747 8.278-30.264 15.035 18.464 33.311 33.213 54.816 44.252 21.507 11.038 44.54 17.227 69.092 18.558-.95-3.616-1.427-8.186-1.427-13.704.0-16.562 5.853-30.692 17.56-42.399 11.703-11.706 25.837-17.561 42.394-17.561 17.515.0 32.079 6.283 43.688 18.846 13.134-2.474 25.892-7.33 38.26-14.56-4.757 14.652-13.613 25.788-26.55 33.402 12.368-1.716 23.88-4.95 34.537-9.708C357.458 149.793 347.462 160.166 335.471 168.735z"/></g></svg></a></div><div class=copyright>¬© Copyright
2022
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span>Noel Bundick</div></footer></body></html>